# Final Task For Cloud Computing

# Image resize by using AWS Lambda function

## Install Dependencies Locally:

```
npm init -y
npm install aws-sdk
npm install --arch=x64 --platform=linux sharp
```

## Create S3 Bucket:

1. AWS Console â†’ S3
2. Create New Bucket
3. Create folders â†’ "original-images" & "resize-images"
4. Edit static website hosting â†’ Enable â†’  Index document: index.html
5. Add Event Nofitication â†’ prefix (original-images/) â†’ event type (All object events) â†’ Trigger (Lambda function) â†’ SAVE



## Create Lambda function:

1. AWS Console â†’ Lambda
2. Create New Lambda

- Node.js 14.x runtime
- x86_64 architecture
- a new role with basic Lambda permissions

3. Create Lambda Code â†’ see the resize.js
4. Package with Zip

Mac

- `zip -r function.zip resize.js node_modules package.json index.js`

Window

- `Compress-Archive -Path index.js, node_modules, package.json -DestinationPath function.zip`

5. Upload Lambda Code

- AWS Console â†’ Code â†’ Upload â†’ select function.zip

## Add S3 event trigger

Lambda Console â†’ Add Trigger â†’ Select S3

Select Bucket â†’ Event types = All Object Create Events â†’ Prefix â†’ Add

## Execution Role

Lambda Console â†’ Configuration â†’ Permissions â†’ "Execution Role" â†’ Navigate to the IAM

Create a new policy to grants read and write access to the S3 bucket.

```
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "Statement1",
			"Effect": "Allow",
			"Action": [
				"s3:PutObject",
				"s3:GetObject",
				"s3:DeleteObject",
				"s3:ListBucket"
			],
			"Resource": [
				"arn:aws:s3:::bucket-name",
				"arn:aws:s3:::bucket-name/*"
			]
		}
	]
}
```

Add created permissions in the Roles. SAVE

ë²„í‚·: source-bucket
ì´ë²¤íŠ¸ ìœ í˜•: PUT (ìƒˆ íŒŒì¼ ì—…ë¡œë“œ ì‹œ ì‹¤í–‰)
3ï¸âƒ£ ì €ì¥ í›„ Lambda ë°°í¬

## Test

1. Upload the image to S3
2. When Lambda executes, the resized image will be stored in the resized-images/ folder
3. Check the result in S3 ğŸš€


## Source:

Lambda Offical Document:
https://docs.aws.amazon.com/lambda/latest/dg/welcome.html

AWS Lambda Sample Code:
https://github.com/aws-samples

AWS Serverless Application Repository
https://serverlessrepo.aws.amazon.com/applications

AWS Offical Blog & Community:
https://aws.amazon.com/blogs/compute/category/serverless/aws-lambda/
https://stackoverflow.com/questions/tagged/aws-lambda
